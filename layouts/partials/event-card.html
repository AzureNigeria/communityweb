{{ $nowUnix := now.Unix }}
{{ $startUnix := .Date.Unix }}
{{ $maxEndUnix := add $startUnix 18000 }}
{{ $endUnix := $maxEndUnix }}
{{ with .Params.end_date }}
  {{ $candidate := (time .).Unix }}
  {{ if lt $candidate $endUnix }}
    {{ $endUnix = $candidate }}
  {{ end }}
{{ end }}
{{ $status := "completed" }}
{{ if lt $nowUnix $startUnix }}
  {{ $status = "upcoming" }}
{{ else if lt $nowUnix $endUnix }}
  {{ $status = "ongoing" }}
{{ end }}
<article class="card event-card">
  <div class="card-image">
    <img src="{{ .Params.featured_image | relURL }}" alt="Event cover for {{ .Title }}" loading="lazy" decoding="async" />
  </div>
  <div class="card-body">
    <div class="event-card__badges">
      {{ if $status }}
        <span class="status-badge {{ $status }}">{{ $status | title }}</span>
      {{ end }}
      <span class="event-date">
        <span class="event-date__month">{{ .Date.Format "Jan" }}</span>
        <span class="event-date__day">{{ .Date.Format "02" }}</span>
      </span>
    </div>
    <h3>{{ .Title }}</h3>
    <p class="muted">{{ .Params.description }}</p>
    <div class="meta">
      <span><img src="{{ "images/icons/clock.svg" | relURL }}" alt="Time icon" />{{ .Date.Format "3:04 PM" }}</span>
      <span><img src="{{ "images/icons/map-pin.svg" | relURL }}" alt="Location icon" />{{ .Params.location }}</span>
    </div>
    {{ if or (eq $status "past") (eq $status "completed") }}
      <a class="btn-secondary btn-small" href="{{ .RelPermalink }}">View Recap</a>
    {{ else if eq $status "ongoing" }}
      <a class="btn-secondary btn-small" href="{{ .RelPermalink }}">Join Live</a>
    {{ else }}
      <a class="btn-primary" href="{{ .RelPermalink }}">Register</a>
    {{ end }}
  </div>
</article>
