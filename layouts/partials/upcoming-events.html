{{ $limit := .Site.Params.homepage.events_to_show }}
{{ $nowUnix := now.Unix }}
{{ $events := where .Site.RegularPages "Section" "events" }}
{{ $upcoming := slice }}
{{ range $events }}
  {{ $startUnix := .Date.Unix }}
  {{ $maxEndUnix := add $startUnix 18000 }}
  {{ $endUnix := $maxEndUnix }}
  {{ with .Params.end_date }}
    {{ $candidate := (time .).Unix }}
    {{ if lt $candidate $endUnix }}
      {{ $endUnix = $candidate }}
    {{ end }}
  {{ end }}
  {{ if lt $nowUnix $endUnix }}
    {{ $upcoming = $upcoming | append . }}
  {{ end }}
{{ end }}
{{ $events = first $limit (sort $upcoming "Date") }}
<section class="section">
  <div class="container">
    <div class="section-heading">
      <h2>Upcoming Events</h2>
      <p>
        Join our next sessions and workshops designed for Azure builders in
        Nigeria.
      </p>
    </div>
    <div class="grid cards-3">
      {{ range $events }} {{ partial "event-card.html" . }} {{ end }}
    </div>
  </div>
</section>
