{{ define "main" }}
  <section class="page-hero tint">
    <div class="container">
      <p class="breadcrumb"><a href="{{ "/" | relURL }}">Home</a> / Study Series</p>
      <h1>Study Series</h1>
      <p class="lead">Structured tracks that take you from fundamentals to advanced Azure skills.</p>
    </div>
  </section>
  {{ $seriesPages := where .Pages "Params.total_sessions" "gt" 0 }}
  {{ $now := now }}
  {{ $current := slice }}
  {{ $upcoming := slice }}
  {{ $past := slice }}
  {{ range $seriesPages }}
    {{ $status := lower .Params.status }}
    {{ $startUnix := 0 }}
    {{ $endUnix := 0 }}
    {{ with .Params.start_date }}
      {{ $startUnix = (time .).Unix }}
    {{ end }}
    {{ with .Params.end_date }}
      {{ $endUnix = (time .).Unix }}
    {{ end }}
    {{ if and (gt $startUnix 0) (gt $endUnix 0) }}
      {{ $nowUnix := $now.Unix }}
      {{ if and (ge $nowUnix $startUnix) (le $nowUnix $endUnix) }}
        {{ $status = "ongoing" }}
      {{ else if lt $nowUnix $startUnix }}
        {{ $status = "upcoming" }}
      {{ else }}
        {{ $status = "completed" }}
      {{ end }}
    {{ end }}
    {{ if eq $status "ongoing" }}
      {{ $current = $current | append . }}
    {{ else if eq $status "upcoming" }}
      {{ $upcoming = $upcoming | append . }}
    {{ else if or (eq $status "completed") (eq $status "past") }}
      {{ $past = $past | append . }}
    {{ end }}
  {{ end }}
  {{ $hasUpcoming := gt (len $upcoming) 0 }}
  {{ $hasCurrent := gt (len $current) 0 }}
  {{ $defaultTab := "past" }}
  {{ if $hasCurrent }}
    {{ $defaultTab = "current" }}
  {{ else if $hasUpcoming }}
    {{ $defaultTab = "upcoming" }}
  {{ end }}
  <section class="section">
    <div class="container">
      <div class="tabs" data-tabs="series">
        <button class="tab {{ if eq $defaultTab "upcoming" }}active{{ end }}" data-tab="upcoming">Upcoming</button>
        <button class="tab {{ if eq $defaultTab "current" }}active{{ end }}" data-tab="current">Current</button>
        <button class="tab {{ if eq $defaultTab "past" }}active{{ end }}" data-tab="past">Past Series</button>
      </div>
      <div class="grid cards-3 series-grid {{ if ne $defaultTab "upcoming" }}hidden{{ end }}" data-tab-content="series" data-tab-panel="upcoming">
        {{ if $hasUpcoming }}
          {{ range $upcoming }}
            {{ partial "series-card.html" . }}
          {{ end }}
        {{ else }}
          <p>No upcoming study series yet. Check back soon.</p>
        {{ end }}
      </div>
      <div class="grid cards-3 series-grid {{ if ne $defaultTab "current" }}hidden{{ end }}" data-tab-content="series" data-tab-panel="current">
        {{ if $hasCurrent }}
          {{ range $current }}
            {{ partial "series-card.html" . }}
          {{ end }}
        {{ else }}
          <p>There is no current study series right now.</p>
        {{ end }}
      </div>
      <div class="grid cards-3 series-grid {{ if ne $defaultTab "past" }}hidden{{ end }}" data-tab-content="series" data-tab-panel="past">
        {{ if gt (len $past) 0 }}
          {{ range $past }}
            {{ partial "series-card.html" . }}
          {{ end }}
        {{ else }}
          <p>No past study series yet.</p>
        {{ end }}
      </div>
    </div>
  </section>
  {{ partial "explore-more.html" . }}
{{ end }}
